.125Queries:
ONUM â†’ Order Number (unique ID for the order)

AMT â†’ Amount of the order

ODATE â†’ Order Date

CNUM â†’ Customer Number 

SNUM â†’ Salesperson Number 

1)List all the columns of the Salespeople table. 

select * from salespeople;

2)List all customers with a rating of 100. 

select * from customers where rating=100;

3)find all records in the Customer table with NULL values in the city column. 

select * from customers where city is null;

4) Find the largest order taken by each salesperson on each date.

select odate,max(amt) ,snum from orders where amt in (select snum from salespeople )group by snum,odate;

5)Arrange the Orders table by descending customer number. 
select * from orders  order by  cnum desc;

6) Find which salespeople currently have orders in the Orders table. 

select snum,sname,onum from salespeople s  join orders o on s.snum=o.snum;


7)List names of all customers matched with the salespeople serving them.


 select cname ,c.snum from customers c left join  salespeople s on c.snum=s.snum;



8)Find the names and numbers of all salespeople who had more than one customer.


select s.sname ,s.snum ,count(c.cnum) total_count from salespeople s join customers c on  c.snum=s.snum  group by s.sname,s.snum  having count(c.cnum)>1 ;


9)Count the orders of each of the salespeople and output the results in descending order.


select s.snum,count(o.onum) from salespeople s join orders o on s.snum=o.snum group by s.snum order by count(onum) desc ;


10) List the Customer table if and only if one or more of the customers in the Customer table are 
located in San Jose.
(if and only if -----> exists)
select * from customers where city  in (select city from customers where City='San Jose');

select * from customers where exist(select 1 from customers where city='San Jose');
11) Match salespeople to customers according to what city they lived in. 


select s.sname,s.snum ,c.city from salespeople s join customers c  on s.snum=c.snum;


12) Find the largest order taken by each salesperson. 


 select snum ,max(amt) from orders  group by snum;


13)Find customers in San Jose who have a rating above 200. 

select * from customers where city='San Jose' and rating>200;


14)List the names and commissions of all salespeople in London.

select sname,city,comm from salespeople where city='London';

15)List all the orders of salesperson Motika from the Orders table. 

select snum,onum from orders where snum in (select snum from salespeople where sname='Motika');

SELECT o.snum, o.onum
FROM orders o
JOIN salespeople s ON o.snum = s.snum
WHERE s.sname = 'Motika';


16) Find all customers with orders on October 3.

select * from customers where cnum in ( select snum from orders where day(odate)=3);

but use below optimize

select * from customers c join orders o on o.cnum=c.cnum where odate='1996-10-03';


17) Give the sums of the amounts from the Orders table, grouped by date, eliminating all those 
dates where the SUM was not at least 2000.00 above the MAX amount.

(chatgpt)
select odate,sum(amt) from orders group by odate having sum(amt)>=max(amt)+2000;

18)Select all orders that had amounts that were greater than at least one of the orders from 
October 6.

select * from orders where amt>(select min(amt) from orders where day(odate)=6);

select * from orders where amt > (select amt from orders where odate='1996-10-06');

19) Write a query that uses the EXISTS operator to extract all salespeople who have customers 
with a rating of 300. 

select * from salespeople s where exists (select rating from customers c where s.snum=c.snum and rating=300); //also called correlated sub query as outer query run with or compare with  inner query
select * from salespeople s where exists (select 1 from customers c where s.snum=c.snum and rating=300);

20) Find all pairs of customers having the same rating. 

select cname,row_number() over(partion by rating order by snum)rn  from customers ;


select  c1.cname AS customer1, c2.cname AS customer2, c1.rating
FROM customers c1
JOIN customers c2 
  ON c1.rating = c2.rating
 AND c1.cnum < c2.cnum;//avoid duplicate


21) Find all customers whose CNUM is 1000 above the SNUM of Serres. 

select * from customers where cnum in( select snum+1000 from salespeople where sname='Serres');

OR

SELECT c.*
FROM customers c
JOIN salespeople s
  ON c.cnum = s.snum + 1000
WHERE s.sname = 'Serres';


22) Give the salespeopleâ€™s commissions as percentages instead of decimal numbers. 

select snum,sname ,comm*100 as Percentage from salespeople ;

select snum,sname ,concat(comm*100, '%') as Percentage from salespeople ;

select snum,sname ,concat(cast(comm * 100 as decimal(5,2)),'%') as Percentage from salespeople ;

////////////23) Find the largest order taken by each salesperson on each date, eliminating those MAX orders 
which are less than $3000.00 in value. 

////



24) List the largest orders for October 3, for each salesperson.

select snum ,onum,odate,amt from orders o where snum in(select snum from salespeople s where s.snum=o.snum) and day(o.odate)=3;

select snum ,onum,odate,amt from orders o where o.amt=(select max(amt) from orders o2 where o2.snum=o.snum and day(o.odate)=3);

25) Find all customers located in cities where Serres (SNUM 1002) has customers. 

select * from customers where snum in (select snum from salespeople where snum=1002 and sname='Serres');


26) Select all customers with a rating above 200.00.

 select * from customers where rating >200;


27) Count the number of salespeople currently listing orders in the Orders table. 

select s.snum,count(s.snum) total_count from salespeople s join orders o on s.snum=o.snum group by snum ;


28) Write a query that produces all customers serviced by salespeople with a commission above 
12%. Output the customerâ€™s name and the salespersonâ€™s rate of commission.

select s.snum,c.cname ,cast(s.comm*100 as decimal(5,0)) from customers c join salespeople s on s.snum=c.snum and cast(s.comm*100 as decimal(5,0))>12; 

29)Find salespeople who have multiple customers.



SELECT s.sname, s.snum, COUNT(c.cnum) AS total_customers
FROM salespeople s
JOIN customers c ON c.snum = s.snum
GROUP BY s.snum, s.sname
HAVING COUNT(c.cnum) > 1;


30) Find salespeople with customers located in their city. 

select * from salespeople s inner join customers c on s.snum=c.snum where s.City=c.city;

31) Find all salespeople whose name starts with â€˜Pâ€™ and the fourth character is â€˜lâ€™. 


select * from salespeople where sname like'P__l';

32) Write a query that uses a subquery to obtain all orders for the customer named Cisneros. 
Assume you do not know his customer number. 

select * from orders where cnum in(select cnum from customers where cname='Cisneros');

33) Find the largest orders for Serres and Rifkin. 

select snum, max(amt) from orders where snum in (select snum from salespeople where sname='Serres' or sname='Rifkin') group by snum;

34)Extract the Salespeople table in the following order : SNUM, SNAME, COMMISSION, CITY. 

select snum,sname ,comm commission ,city from salespeople ;

35)Select all customers whose names fall in between â€˜Aâ€™ and â€˜Gâ€™ alphabetical range.

select * from customers where cname>= 'A' and cname<= 'H';


OR  

select * from customers where cname between 'A' and 'H';

36) Select all the possible combinations of customers that you can assign. 

select * from customers c1 join customers c2 on c1.cnum<c2.cnum;

37)Select all orders that are greater than the average for October 4. 

select * from orders where amt>(select avg(amt) from orders where day(odate)=4);

/////38). Write a select command using a corelated subquery that selects the names and numbers of all 
customers with ratings equal to the maximum for their city.
//////

39) Write a query that totals the orders for each day and places the results in descending order. 

select onum,odate,sum(amt) as result from orders group by odate order by result desc; 

40)  Write a select command that produces the rating followed by the name of each customer in 
San Jose.

select cname ,rating from customers where city='San Jose';


41). Find all orders with amounts smaller than any amount for a customer in San Jose

select * from orders  where amt<(select max(amt) from orders o,customers c where o.cnum=c.cnum and city='San Jose');
select * from orders  where amt< any (select amt from orders o,customers c where o.cnum=c.cnum and city='San Jose');
(< operator handle only one value at time )


42) Find all orders with above average amounts for their customers

SELECT o.onum, o.cnum, o.amt
FROM orders o
WHERE o.amt > (
    SELECT AVG(o2.amt)
    FROM orders o2
    WHERE o2.cnum = o.cnum
);

43)Write a query that selects the highest rating in each city.

select * from customers where rating =(select  max(rating) from customers group by city );


SELECT c1.city, c1.cname, c1.rating
FROM customers c1
WHERE c1.rating = (
    SELECT MAX(c2.rating)
    FROM customers c2
    WHERE c2.city = c1.city
);

44). Write a query that calculates the amount of the salespersonâ€™s commission on each order by a 
customer with a rating above 100.00. 


select s.snum ,s.sname ,s.comm,c.rating from salespeple s join customers on c.snum=s.snum where c.rating >100 and 
(select o.snum  from order o  where o.snum=s.snum);



select s.snum,s.sname,o.amt,s.comm,cast((o.amt*s.comm) decimal(10,2)) as Commision_amount from salespeople s join orders o on s.snum=o.snum  join customers c on c.snum=o.snum where rating>100 ;


45)  Count the customers with ratings above San Joseâ€™s average. 

select * from customers where rating >(select avg(Rating) from customers where city='San Jose');


//////////
46) . Write a query that  produces all pairs of salespeople with themselves as well as duplicate rows 
with the order reversed.

////////


47) Find all salespeople that are located in either Barcelona or London.

select * from salespeople where city in ('Barcelona','London');


48)Find all salespeople with only one customer.

select s.sname,count(c.snum) from salespeople s join customers c on s.snum=c.snum  group by s.snum,s.sname having count(c.snum)=1;  


49) Write a query that joins the Customer table to itself to find all pairs of customers served by a 
single salesperson.

	select c1.cname,c2.cname from customers c1 join customers c2 on c1.snum =c2.snum where  c1.cname < c2.cname;

50)Write a query that will give you all orders for more than $1000.00
select  * from orders where amt >1000;


51)Write a query that lists each order number followed by the name of the customer who made 
that order. 

select onum, cname from  orders  o join customers c on o.snum=c.snum;

52)Write 2 queries that select all salespeople (by name and number) who have customers in their 
cities who they do not service, one using a join and one a corelated subquery. Which solution 
is more elegant? 

select s.sname ,s.snum from salespeople s where s.city in (select city from customers c where s.snum <>c.snum and s.city=c.city);
OR
select s.sname ,s.snum from salespeople s where Exists (select city from customers c where s.snum <>c.snum and s.city=c.city);



select s.sname,s.snum  from salespeople s join customers c on s.city=c.city  where s.snum <> c.snum;

---->The correlated subquery is more elegant and readable â€” it clearly expresses the logic:

â€œFind salespeople who have customers in their city but are not their own customers.â€


53) Write a query that selects all customers whose ratings are equal to or greater than ANY (in the 
SQL sense) of Serresâ€™?

select * from customers c where rating >= any (select rating from customers where snum in(select s.snum from salespeople s where sname='Serres'));



54) Write 2 queries that will produce all orders taken on October 3 or October 4.

select * from orders where day(odate) in(3,4); 	

OR

select * from orders where odate='1996-10-03' or date='1996-10-04';

55)Write a query that produces all pairs of orders by a given customer. Name that customer and eliminate duplicates. 

select distinct c.cname ,o1.onum as order1, o2.onum as order2 from customers c
 join orders o1 on c.cnum=o1.cnum 
join orders o2 on c.cnum=o2.cnum
where o1.onum < o2.onum
 ;

56)Find only those customers whose ratings are higher than every customer in Rome. 

select * from customers where rating > all (select rating from customers where city='Rome');

 57)Write a query on the Customers table whose output will exclude all customers with a rating <= 100.00, unless they are located in Rome. 

select * from customers where rating >100 or city='Rome';

58)Find all rows from the Customers table for which the salesperson number is 1001. 

select * from customers where snum=1001;

59. Find the total amount in Orders for each salesperson for whom this total is greater than the 
amount of the largest order in the table. 

select sum(amt),snum from orders group by snum having sum(amt) >(select max(amt) from orders); 

select sum(o1.amt) ,sname,o1.snum from orders o1, salespeople s  where s.snum=o1.snum group by o1.snum,sname having sum(o1.amt)>(select max(amt) from orders);


60) Write a query that selects all orders save those with zeroes or NULLs in the amount field. 


select * from orders where amt=0 or amt is null;

61). Produce all combinations of salespeople and customer names such that the former precedes 
the latter alphabetically, and the latter has a rating of less than 200.

 select distinct sname ,cname from salespeople s,customers c where sname < cname and rating<200;

62) List all Salespeopleâ€™s names and the Commission they have earned.

 select sname,cast(sum(comm*amt) as decimal(10,2)) as Total_Commission  from salespeople s join orders o on s.snum=o.snum group by s.snum ,s.sname;

63)Write a query that produces the names and cities of all customers with the same rating as 
Hoffman. Write the query using Hoffmanâ€™s CNUM rather than his rating, so that it would still be usable if his rating changed. 

select cname ,city,rating from customers c where  rating=(select rating from customers where cnum=2001);


64) Find all salespeople for whom there are customers that follow them in alphabetical order. 


select * from salespeople s join customers c on s.snum=c.snum where sname<cname;


 65)Write a query that produces the names and ratings of all customers of all who have above 
average orders. 


select c.cname,c.rating,c.snum from customers c join orders o on o.snum=c.snum where o.amt> (select avg(amt) from orders);
 
or

select c.cname,c.rating,c.snum from customers c join orders o on o.snum=c.snum 
group by c.snum, c.cname,c.rating having sum(o.amt) > (select avg(amt) from orders);



 66)Find the SUM of all purchases from the Orders table.
select cast(sum(amt) as decimal(10,2)) as Sum_of_allorders from orders; 


 67)Write a SELECT command that produces the order number, amount and date for all rows in 
the order table. 

select onum,amt,odate from orders;

68) Count the number of nonNULL rating fields in the Customers table (including repeats).

select count(rating) as Total_count from customers where rating is not null;


69)Write a query that gives the names of both the salesperson and the customer for each order 
after the order number.  

select o.onum,s.sname,c.cname from customers c join salespeople s
 on c.snum=s.snum  join orders o on o.snum=s.snum;
 
70) List the commissions of all salespeople servicing customers in London.

select sname ,comm from salespeople where snum in(select snum from customers where city='London';


71)Write a query using ANY or ALL that will find all salespeople who have no customers located in their city. 

select * from salespeople where city != all(select city from customers );

72)Write a query using the EXISTS operator that selects all salespeople with customers located in their cities who are not assigned to them. 

select s.snum, s.sname from salespeople s where EXISTS( select snum from customeres c where s.city = c.city and s.snum <> c.snum  );

73) Write a query that selects all customers serviced by Peel or Motika. (Hint : The SNUM field relates the two tables to one another.) 

select cnum,cname,snum from customers where snum in (select snum from sales people where sname in ('Peel','Motika'));

74. Count the number of salespeople registering orders for each day. (If a salesperson has more than one order on a given day, he or she should be counted only once.)

select snum,count(distinct(snum)) as count ,odate from orders group by odate;

75. Find all orders attributed to salespeople in London.

select ONUM,odate, snum from orders where snum in ( select snum from salespeople where city='London');

76. Find all orders by customers not located in the same cities as their salespeople.

select o.onum ,o.snum 
from orders o where 
snum in(select c.snum from customers c join salespeople s on s.snum=c.snum where s.city <>c.city);

 77.Find all salespeople who have customers with more than one current order. 



select distinct  s.snum, s.sname ,o.cnum from salespeople s join orders o on s.snum=o.snum where o.cnum in ( select cnum from orders group by cnum having count(cnum) > 1);


Optimizes

SELECT DISTINCT s.snum, s.sname
FROM salespeople s
JOIN orders o ON s.snum = o.snum
GROUP BY s.snum, s.sname, o.cnum
HAVING COUNT(*) > 1;



 78)Write a query that extracts from the Customers table every customer assigned to a 
salesperson who currently has at least one other customer (besides the customer being 
selected) with orders in the Orders table. 




79. Write a query that selects all customers whose names begin with â€˜Câ€™. 

select * from customers where cname like 'C%';


80) Write a query on the Customers table that will find the highest rating in each city. Put the output in this form : for the city (city) the highest rating is : (rating).


select concat('for he city ',city ,' the highest rating is :',max(rating) )as result from customers group by city;



81)Write a query that will produce the SNUM values of all salespeople with orders currently in the Orders table (without any repeats)

From interview point of view Joins are more prefered
select distinct s.snum from salespeople s join orders o on s.snum=o.snum ;

select distinct snum from salespeople where snum in (select snum from onum );

82) Write a query that lists customers in descending order of rating. Output the rating field first, followed by the customerâ€™s names and numbers. 


select rating , cname,cnum from customers order by rating desc;

83. Find the average commission for salespeople in London. 

select avg(comm) from salespeople where city='London';

(Prefered)
select avg(comm) from salespeople where city='London' and comm is not null;


84. Find all orders credited to the same salesperson who services Hoffman (CNUM 2001). 


 select o.onum from orders o join customers c on o.snum=c.snum where c.cnum=2001;


85. Find all salespeople whose commission is in between 0.10 and 0.12 (both inclusive)

select sname,snum ,comm from salespeople where comm >= 0.10 and comm <=0.12;



86)Write a query that will give you the names and cities of all salespeople in London with a commission above 0.10. 

select sname,city,comm from salespeople where city='London' and comm >0.10;



87. What will be the output from the following query?      
SELECT * FROM ORDERS where (amt < 1000 OR NOT (odate = 10/03/1996 AND cnum > 
2003)); 

+------+---------+------------+------+------+
| ONUM | AMT     | ODATE      | CNUM | SNUM |
+------+---------+------------+------+------+
| 3001 |   18.69 | 1996-10-03 | 2008 | 1007 |
| 3003 |  767.19 | 1996-10-03 | 2001 | 1001 |
| 3002 |  1900.1 | 1996-10-03 | 2007 | 1004 |
| 3005 | 5160.45 | 1996-10-03 | 2003 | 1002 |
| 3006 | 1098.16 | 1996-10-03 | 2008 | 1007 |
| 3009 | 1713.23 | 1996-10-04 | 2002 | 1003 |
| 3007 |   75.75 | 1996-10-04 | 2002 | 1003 |
| 3008 |    4723 | 1996-10-05 | 2006 | 1001 |
| 3010 | 1309.95 | 1996-10-06 | 2004 | 1002 |
| 3011 | 9891.88 | 1996-10-06 | 2006 | 1001 |
+------+---------+------------+------+------+




88. Write a query that selects each customerâ€™s smallest order. 


select cnum ,min(amt) from orders group by cnum; 

## try to solve this using without the fun
select o.cnum ,o.amt from orders o where amt<=all(select amt from orders where o.cnum=cnum);


89. Write a query that selects the first customer in alphabetical order whose name begins with G.

select cname from customers where cname like 'G%' order by cname limit 1;

 
90. Write a query that counts the number of different nonNULL city values in the Customers table. 

select count(distinct city) from customers where city is not null;

91. Find the average amount from the Orders table.
  select avg(amt) from orders;
 
add roundup( from my side)

select round(avg(amt),2) from orders;


92.What would be the output from the following query?      
SELECT * FROM ORDERS WHERE NOT (odate = 10/03/96 OR snum > 1006) AND amt >= 
1500);

--> out put is table contain number of sales person which have amt greater than 1500 and date is 10-03-1996 

93. Find all customers who are not located in San Jose and whose rating is above 200.
select * from customers where not (city='San jose') and rating > 200;
 
94. Give a simpler way to write this query :       
SELECT snum, sname city, comm FROM salespeople  
WHERE (comm > + 0.12 OR comm < 0.14);
	
select * from salespeople ;

95)Evaluate the following query : 
SELECT * FROM orders  
WHERE NOT ((odate = 10/03/96 AND snum > 1002) OR amt > 2000.00); 

96) Which salespersons attend to customers not in the city they have been assigned to? 

select s.snum,s.city,c.city from salespeople s join customers c on s.snum =c.snum where s.city <>c.city;

97)Which salespeople get commission greater than 0.11 are serving customers rated less than 250? 

select * from salespeople where comm>.11 and snum in (select snum from customers where rating < 250);

select distinct s.*,c.rating from salespeople s join customers c on s.snum=c.snum where s.comm>0.11 and c.rating<250;


98) Which salespeople have been assigned to the same city but get different commission percentages?
 select distinct s1.* from salespeople s1 join salespeople s2 on s1.city=s2.city and  s1.comm <> s2.comm and s1.snum<s2.snum;


99) Which salesperson has earned the most by way of commission? 


select s.sname,s.snum, sum(o.amt*s.comm) total_comm from salespeople s join orders o on s.snum=o.snum group by s.snum,s.sname order by total_comm desc limit 1;



100.Does the customer who has placed the maximum number of orders have the maximum rating?

first find max count of orders
select cnum,count(*) from orders group by cnum order by count(*) desc limit 1;

then use case
select case when c.rating=(select max(rating) from customers) then 'Yes' else 'No' end as result from customers c where c.cnum =(select cnum from orders  group by cnum order by count(*) desc limit 1);


101.Has the customer who has spent the largest amount of money been given the highest rating? 

select case when c.rating=(select max(rating) from customers) then "Yes" else 'NO' end as result from customers c join orders o on c.cnum=o.cnum order by amt desc limit 1;

Why this is wrong âŒ

order by amt desc limit 1
ðŸ‘‰ picks the largest single order, not the customer who spent the most in total

Question asks â€œspent the largest amount of moneyâ€
ðŸ‘‰ requires SUM(o.amt) per customer

Correct query


select 
  case 
    when c.rating = (select max(rating) from customers)
    then 'Yes'
    else 'No'
  end as result
from customers c
join (
    select cnum, sum(amt) as total_spent
    from orders
    group by cnum
    order by total_spent desc
    limit 1
) t
on c.cnum = t.cnum;




102.List all customers in descending order of customer rating. 

select * from customers order by rating desc;


103.On which days has Hoffman placed orders? 

select o.odate from orders o join customers c on o.cnum=c.cnum where c.cname='Hoffman';


104.Do all salespeople have different commissions? 

select case when snum=(select s.snum from salespeople s ,salespeople s1 where s.comm=s1.comm and s.snum<s1.snum) then 'yes' else 'No' end as result from salespeople;
op-->+--------+
| result |
+--------+
| No     |
| No     |
| No     |
| No     |
| No     |
| No     |
+--------+
Above logic is  Wrong 

If any two salespeople have the same commission â†’ answer must be NO

We want single op
1)  use Exists operator rather than snum=(select...
op--> when exists( select 1 from.... same as it is

2) use count() fun (best ans )

select case when count(*)=count( distinct comm) then 'yes' else 'NO' end as result from salespeople ;

op-->How this works

count(*) â†’ total salespeople

count(distinct comm) â†’ unique commissions

If both equal â†’ all commissions are different





105.Which salespeople have no orders between 10/03/1996 and 10/05/1996?

select o.snum,s.sname from orders o join salespeople s on o.snum=s.snum where odate not between date '1996-10-03' and date '1996-10-05';

select 	s.snum,s.sname from salespeople s where not exists (select 1 from orders o where o.snum=s.snum and odate between date '1996-10-03' and date '1996-10-05') ;


106.How many salespersons have succeeded in getting orders? 

select s.snum,count(*) from salespeople s join orders o on o.snum=s.snum group by s.snum;

op->
+------+----------+
| snum | count(*) |
+------+----------+
| 1007 |        2 |
| 1001 |        3 |
| 1004 |        1 |
| 1002 |        2 |
| 1003 |        2 |
+------+----------+

Above query is wrong--->
But the question asks HOW MANY salespersons, not order counts per salesperson


select  count(distinct s.snum) from salespeople s join orders o on s.snum=o.snum;

or

select count(distinct o.snum) as salesperson_count from orders o;

107.How many customers have placed orders?

select count(distinct cnum ) from orders; 

108.On which date has each salesperson booked an order of maximum value? 

a) With sub query(correlated sub query)
select o.odate from orders o where amt=(select max(o1.amt) from orders o1 where o1.snum=o.snum);

b) without subquery
select odate,snum from (select odate,snum,amt ,max(amt) over (partition by snum )  max_amt  from orders )  t where amt= max_amt; 

109.Who is the most successful salesperson? 

select s.snum,sum(o.amt) from salespeople s join orders o on s.snum=o.snum group by s.snum order by sum(o.amt) desc limit 1;

110.Who is the worst customer with respect to the company?


select s.snum,sum(o.amt) from salespeople s join orders o on s.snum=o.snum group by s.snum order by sum(o.amt)  limit 1;


111.Are all customers not having placed orders greater than 200 totally been serviced by 
salespersons Peel or Serres? 

select case when ( select c.cname from customers c join salespeople s on c.snum=s.snum where s.sname not in ('Seeres' ,'Peel') and not exists (select o.cnum from orders o where o.cnum=c.cnum and o.amt>200)) then 'No' else 'Yes' end as result;

112.Which customers have the same rating?

select c.cname from customers c ,customers c1 where c.rating=c1.rating and c.cnum<c1.cnum;

113.Find all orders greater than the average for October 4th.

select * from orders  where amt > (select avg(amt) from orders where odate=date '1996-10-4'); 



114.Which customers have above average orders? 

select c.cname ,o.cnum from customers c join orders o on c.cnum=o.cnum where o.amt>(select avg(o1.amt) from orders o1 where o1.cnum=o.cnum);


115.List all customers with ratings above San Joseâ€™s average. 

select * from customers where rating > any(select avg(rating) from customers where city='San Jose');

116.Select the total amount in orders for each salesperson for whom the total is greater than the 
amount of the largest order in the table. 

select snum ,sum(amt) as total_sum from orders group by snum having total_sum > (select max(amt) from orders); 

117.Give names and numbers of all salespersons who have more than one customer. 

select s.sname,count(c.cnum) from salespeople s join customers c on s.snum=c.snum group by s.sname having count(c.cnum)>1;

118.Select all salespersons by name and number who have customers in their city whom they 
donâ€™t service. 
select s.snum ,s.sname from salespeople s join customers c on s.city=c.city where s.snum <> c.snum ;


119.Which customersâ€™ rating  should be lowered? 

SELECT c.cnum, c.cname, SUM(o.amt) AS total_purchase
FROM customers c
JOIN orders o ON c.cnum = o.cnum
GROUP BY c.cnum, c.cname
HAVING SUM(o.amt) <
(
    SELECT AVG(customer_total)
    FROM (
        SELECT SUM(amt) AS customer_total
        FROM orders
        GROUP BY cnum
    ) t
);


120.Is there a case for assigning a salesperson to Berlin?
SELECT 'YES' AS need_salesperson
WHERE EXISTS (
    SELECT 1
    FROM customers c
    WHERE c.city = 'Berlin'
)
AND NOT EXISTS (
    SELECT 1
    FROM salespeople s
    WHERE s.city = 'Berlin'
);



select "Yes" where exits(select 1 from customers c  where c.city="Berlin') and not exists(select 1 from salepeople s where s.city='Berlin');

21.Is there any evidence linking the performance of a salesperson to the commission that he or 
she is being paid? 

SELECT s.sname,
       s.commission,
       SUM(o.amt) AS total_sales
FROM salespeople s
LEFT JOIN orders o 
       ON s.snum = o.snum
GROUP BY s.snum, s.sname, s.commission
ORDER BY s.commission DESC;''What this shows:

If higher commission â†’ higher total sales

You can visually check correlation.


122.Does the total amount in orders by customer in Rome and London exceed the commission 
paid to salespersons in London and New York by more than 5 times? 

SELECT 
CASE 
   WHEN 
      (SELECT SUM(o.amt)
       FROM orders o
       JOIN customers c ON o.cnum = c.cnum
       WHERE c.city IN ('Rome','London'))
   >
      5 *
      (SELECT SUM(s.commission)
       FROM salespeople s
       WHERE s.city IN ('London','New York'))
   THEN 'YES'
   ELSE 'NO'
END AS result;

123.Which is the date, order number, amt and city for each salesperson (by name) for the 
maximum order he has obtained? 
SELECT s.sname,
       o.odate,
       o.onum,
       o.amt,
       c.city
FROM orders o
JOIN salespeople s ON o.snum = s.snum
JOIN customers c ON o.cnum = c.cnum
WHERE (o.snum, o.amt) IN (
    SELECT snum, MAX(amt)
    FROM orders
    GROUP BY snum
)
ORDER BY s.sname;


124.Which salesperson(s) should be fired? 
 SELECT s.sname
FROM salespeople s
JOIN orders o ON s.snum = o.snum
GROUP BY s.snum, s.sname
ORDER BY SUM(o.amt)
LIMIT 1;

125.What is the total income for the company? 
SELECT SUM(o.amt * s.commission) AS total_income
FROM orders o
JOIN salespeople s ON o.snum = s.snum;


 or

SELECT SUM(amt) AS total_income
FROM orders;


